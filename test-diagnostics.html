<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Export Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 12px;
            margin: 20px 0;
            font-size: 14px;
        }
        .label {
            font-weight: bold;
            color: #666;
        }
        .value {
            color: #333;
            font-family: monospace;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .status {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        .status.good { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.bad { background: #f8d7da; color: #721c24; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #545b62;
        }
        #console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            margin-top: 20px;
        }
        .log-entry {
            margin: 4px 0;
        }
        .log-info { color: #4fc3f7; }
        .log-success { color: #81c784; }
        .log-warning { color: #ffb74d; }
        .log-error { color: #e57373; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>üîç PDF Export Test & Diagnostic Tool</h1>
        <p>This page helps diagnose PDF export issues. Click the button below to test your device capabilities.</p>
        
        <button onclick="runDiagnostics()">üöÄ Run Diagnostics</button>
        <button class="secondary" onclick="copyResults()">üìã Copy Results</button>
        
        <div id="results" class="hidden">
            <h2>Device Information</h2>
            <div class="info-grid">
                <div class="label">Browser:</div>
                <div class="value" id="browser"></div>
                
                <div class="label">OS:</div>
                <div class="value" id="os"></div>
                
                <div class="label">Screen Resolution:</div>
                <div class="value" id="screen"></div>
                
                <div class="label">Device Pixel Ratio:</div>
                <div class="value" id="dpr"></div>
                
                <div class="label">Memory (GB):</div>
                <div class="value" id="memory"></div>
                
                <div class="label">CPU Cores:</div>
                <div class="value" id="cores"></div>
                
                <div class="label">Connection:</div>
                <div class="value" id="connection"></div>
                
                <div class="label">Canvas Support:</div>
                <div class="value" id="canvas"></div>
                
                <div class="label">Max Canvas Size:</div>
                <div class="value" id="maxCanvas"></div>
            </div>
            
            <h2>Export Capability Assessment</h2>
            <div id="assessment"></div>
            
            <h2>Recommendations</h2>
            <div id="recommendations"></div>
        </div>
        
        <div id="console-output" class="hidden"></div>
    </div>

    <script>
        let logOutput = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logOutput.push(entry);
            
            const consoleDiv = document.getElementById('console-output');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = entry;
            consoleDiv.appendChild(logEntry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function getBrowser() {
            const ua = navigator.userAgent;
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Edg')) return 'Edge';
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Safari')) return 'Safari';
            return 'Unknown';
        }

        function getOS() {
            const ua = navigator.userAgent;
            if (ua.includes('Win')) return 'Windows';
            if (ua.includes('Mac')) return 'macOS';
            if (ua.includes('Linux')) return 'Linux';
            if (ua.includes('Android')) return 'Android';
            if (ua.includes('iOS')) return 'iOS';
            return 'Unknown';
        }

        function testMaxCanvasSize() {
            const canvas = document.createElement('canvas');
            let size = 1000;
            let maxSize = 0;
            
            while (size <= 32000) {
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                if (!ctx) break;
                
                ctx.fillStyle = 'rgb(255, 0, 0)';
                ctx.fillRect(size - 1, size - 1, 1, 1);
                
                const data = ctx.getImageData(size - 1, size - 1, 1, 1).data;
                if (data[0] === 255) {
                    maxSize = size;
                    size += 1000;
                } else {
                    break;
                }
            }
            
            return maxSize || 'Unknown';
        }

        async function runDiagnostics() {
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('console-output').classList.remove('hidden');
            document.getElementById('console-output').innerHTML = '';
            logOutput = [];
            
            log('Starting diagnostics...', 'info');
            
            // Basic Info
            const browser = getBrowser();
            const os = getOS();
            const screen = `${window.screen.width}x${window.screen.height}`;
            const dpr = window.devicePixelRatio || 1;
            const memory = navigator.deviceMemory || 'Unknown';
            const cores = navigator.hardwareConcurrency || 'Unknown';
            const connection = navigator.connection ? 
                `${navigator.connection.effectiveType} (${navigator.connection.downlink} Mbps)` : 
                'Unknown';
            
            document.getElementById('browser').textContent = browser;
            document.getElementById('os').textContent = os;
            document.getElementById('screen').textContent = screen;
            document.getElementById('dpr').textContent = dpr;
            document.getElementById('memory').textContent = memory;
            document.getElementById('cores').textContent = cores;
            document.getElementById('connection').textContent = connection;
            
            log(`Browser: ${browser}`, 'info');
            log(`OS: ${os}`, 'info');
            log(`Memory: ${memory} GB`, 'info');
            log(`CPU Cores: ${cores}`, 'info');
            
            // Canvas Support
            const canvas = document.createElement('canvas');
            const hasCanvas = !!canvas.getContext('2d');
            document.getElementById('canvas').textContent = hasCanvas ? '‚úì Supported' : '‚úó Not Supported';
            
            if (hasCanvas) {
                log('Canvas 2D: Supported', 'success');
                const maxCanvas = testMaxCanvasSize();
                document.getElementById('maxCanvas').textContent = `${maxCanvas}x${maxCanvas}`;
                log(`Max Canvas Size: ${maxCanvas}x${maxCanvas}`, 'info');
            } else {
                log('Canvas 2D: NOT SUPPORTED!', 'error');
                document.getElementById('maxCanvas').textContent = 'N/A';
            }
            
            // Assessment
            const assessmentDiv = document.getElementById('assessment');
            const recommendationsDiv = document.getElementById('recommendations');
            
            let score = 0;
            let issues = [];
            let recommendations = [];
            
            // Check memory
            if (memory === 'Unknown' || memory >= 8) {
                score += 25;
                log('Memory: Excellent (8GB+)', 'success');
            } else if (memory >= 4) {
                score += 15;
                log('Memory: Good (4GB+)', 'success');
                recommendations.push('Consider closing other applications during PDF export');
            } else {
                score += 5;
                log('Memory: Low (< 4GB)', 'warning');
                issues.push('Low memory may cause PDF export failures');
                recommendations.push('‚ö†Ô∏è Close all unnecessary tabs and applications before exporting');
                recommendations.push('‚ö†Ô∏è Export smaller documents (3-4 pages at a time)');
            }
            
            // Check CPU
            if (cores === 'Unknown' || cores >= 4) {
                score += 25;
                log('CPU: Excellent (4+ cores)', 'success');
            } else if (cores >= 2) {
                score += 15;
                log('CPU: Good (2+ cores)', 'success');
            } else {
                score += 5;
                log('CPU: Limited (< 2 cores)', 'warning');
                issues.push('Limited CPU may slow down PDF export');
                recommendations.push('‚ö†Ô∏è Be patient during export (may take longer)');
            }
            
            // Check Canvas
            if (hasCanvas) {
                const maxSize = parseInt(document.getElementById('maxCanvas').textContent);
                if (maxSize >= 16000) {
                    score += 25;
                    log('Canvas: Excellent (16K+)', 'success');
                } else if (maxSize >= 8000) {
                    score += 15;
                    log('Canvas: Good (8K+)', 'success');
                } else {
                    score += 5;
                    log('Canvas: Limited (< 8K)', 'warning');
                    issues.push('Limited canvas size may affect quality');
                }
            } else {
                log('Canvas: NOT SUPPORTED', 'error');
                issues.push('‚ùå Canvas not supported - PDF export will NOT work');
            }
            
            // Check DPR
            if (dpr >= 2) {
                score += 25;
                log('Display: High DPI (Retina)', 'success');
            } else {
                score += 15;
                log('Display: Standard DPI', 'info');
            }
            
            // Final Assessment
            let statusClass, statusText;
            if (score >= 90) {
                statusClass = 'good';
                statusText = '‚úì EXCELLENT - Your device should handle PDF export perfectly';
                log('Overall Assessment: EXCELLENT', 'success');
            } else if (score >= 70) {
                statusClass = 'good';
                statusText = '‚úì GOOD - Your device should handle PDF export well';
                log('Overall Assessment: GOOD', 'success');
            } else if (score >= 50) {
                statusClass = 'warning';
                statusText = '‚ö† MODERATE - PDF export may have issues with large documents';
                log('Overall Assessment: MODERATE', 'warning');
            } else {
                statusClass = 'bad';
                statusText = '‚úó LIMITED - PDF export may fail or be very slow';
                log('Overall Assessment: LIMITED', 'error');
            }
            
            assessmentDiv.innerHTML = `
                <div class="status ${statusClass}">${statusText}</div>
                <p><strong>Score: ${score}/100</strong></p>
            `;
            
            if (issues.length > 0) {
                assessmentDiv.innerHTML += '<h3>Issues Detected:</h3><ul>' + 
                    issues.map(i => `<li>${i}</li>`).join('') + '</ul>';
            }
            
            if (recommendations.length > 0) {
                recommendationsDiv.innerHTML = '<ul>' + 
                    recommendations.map(r => `<li>${r}</li>`).join('') + '</ul>';
            } else {
                recommendationsDiv.innerHTML = '<p>‚úì No specific recommendations - your device is well-suited for PDF export.</p>';
            }
            
            log('Diagnostics complete!', 'success');
        }

        function copyResults() {
            const text = logOutput.join('\n') + '\n\n' +
                'Device Summary:\n' +
                `Browser: ${document.getElementById('browser').textContent}\n` +
                `OS: ${document.getElementById('os').textContent}\n` +
                `Memory: ${document.getElementById('memory').textContent}\n` +
                `CPU: ${document.getElementById('cores').textContent}\n` +
                `Canvas: ${document.getElementById('maxCanvas').textContent}`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úì Results copied to clipboard!');
            }).catch(() => {
                alert('Failed to copy. Please manually copy from the console output.');
            });
        }
    </script>
</body>
</html>
